<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stupid Simple Backend - Admin Dashboard</title>
    <link rel="icon" type="image/x-icon" href="/admin/favicon.ico">

    <!-- Import Maps for Component Aliases -->
    <script type="importmap">
    {
      "imports": {
        "@ui/CardContainer": "/ui/components/layout/CardContainer.js",
        "@ui/DataTable": "/ui/components/data-display/DataTable.js",
        "@ui/SearchBar": "/ui/components/inputs/SearchBar.js",
        "@ui/Button": "/ui/components/inputs/Button.js",
        "@ui/Pagination": "/ui/components/navigation/Pagination.js",
        "@ui/StatCard": "/ui/components/data-display/StatCard.js",
        "@ui/ActionRegistry": "/ui/components/ActionRegistry.js",
        "@economy/": "/plugins/@core/economy/ui/",
        "@achievements/": "/plugins/@core/achievements/ui/",
        "@leaderboards/": "/plugins/@core/leaderboards/ui/"
      }

    }
    </script>

    <!-- Legacy styles (load first, will be overridden) -->
    <link rel="stylesheet" href="style.css">

    <!-- Theme System (Epic 6) -->
    <link rel="stylesheet" href="/ui/styles/theme.css">

    <!-- Modern Dashboard Styles (Story 4.2) - LOADS LAST TO OVERRIDE -->
    <link rel="stylesheet" href="modern-dashboard.css">
    <link rel="stylesheet" href="plugin-enhancements.css">
</head>

<body class="admin-dashboard">
    <!-- Top Navigation Bar -->
    <nav class="top-nav">
        <div class="top-nav__brand">
            <img src="/admin/assets/SSBackend_title_logo.png" alt="Stupid Simple Backend" class="top-nav__logo">
        </div>

        <div class="top-nav__projects">
            <select id="projectSelector" class="project-selector">
                <option value="default">Loading projects...</option>
            </select>
            <button id="manageProjectsButton" class="btn btn-secondary btn-manage-projects" title="Manage Projects">
                <span>âš™ï¸</span>
            </button>
        </div>

        <div class="top-nav__links">
            <a href="#users" class="top-nav__link top-nav__link--active" data-view="users">
                <span>ğŸ‘¥</span> Users
            </a>
            <a href="#saves" class="top-nav__link" data-view="saves">
                <span>ğŸ’¾</span> Saves
            </a>
            <a href="#progress" class="top-nav__link" data-view="progress">
                <span>ğŸ“ˆ</span> Progress
            </a>

            <a href="#exports" class="top-nav__link" data-view="exports">
                <span>ğŸ“¥</span> Export
            </a>
        </div>

        <div class="top-nav__actions">
            <button id="helpButton" class="btn btn-info btn-help-hint">
                <span>â“</span> Help
            </button>
            <button id="refreshButton" class="btn btn-secondary">
                <span>ğŸ”„</span> Refresh
            </button>
            <button id="logoutButton" class="btn btn-danger">
                <span>ğŸšª</span> Logout
            </button>
        </div>
    </nav>

    <!-- Plugin Tab Bar -->
    <div class="plugin-tabs-wrapper">
        <div id="plugin-dropdown-container" class="plugins-dropdown">
            <button class="plugins-dropdown-trigger" id="pluginMenuTrigger">ğŸ§©</button>
            <div class="plugins-dropdown-menu" id="pluginMenu" style="display: none;">
                <div class="plugins-dropdown-header">Available Plugins</div>
            </div>
        </div>
        <div id="plugin-tabs-container" class="plugin-tabs-container"></div>
    </div>

    <!-- Main Content -->
    <main class="content-container">
        <div id="core-dashboard-content" class="dashboard-view">
            <div class="dashboard-header">
                <h2 id="viewTitle">Users Management</h2>
                <div class="dashboard-stats" id="dashboardStats">
                    <div class="stat-card">
                        <span class="stat-number" id="statNumber">-</span>
                        <span class="stat-label" id="statLabel">Loading...</span>
                    </div>
                </div>
            </div>
            <div class="dashboard-controls">
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="Search..." class="search-input">
                    <button id="searchButton" class="btn btn-primary">ğŸ” Search</button>
                </div>
                <div class="view-controls">
                    <button id="exportCurrentButton" class="btn btn-success">ğŸ“¥ Export Current</button>
                    <button id="autoRefreshToggle" class="btn btn-secondary">â° Auto-refresh: OFF</button>
                </div>
            </div>
            <div class="dashboard-content" id="dashboardContent">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <p>Loading data...</p>
                </div>
            </div>
        </div>
        <div id="plugin-content-area" style="display: none;">
            <div id="economy-plugin-container" class="plugin-view" style="display: none;">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <p>Loading Economy Plugin...</p>
                </div>
            </div>
            <div id="achievements-plugin-container" class="plugin-view" style="display: none;">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <p>Loading Achievements Plugin...</p>
                </div>
            </div>
            <div id="leaderboards-plugin-container" class="plugin-view" style="display: none;">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <p>Loading Leaderboards Plugin...</p>
                </div>
            </div>
        </div>
    </main>

    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Details</h3>
                <span class="modal-close">&times;</span>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>
    <div id="toast" class="toast">
        <div class="toast-content"><span id="toastMessage"></span></div>
    </div>

    <script type="module">
        import ActionRegistry from '@ui/ActionRegistry';
        import { HelpCenter } from './ui/components/HelpCenter.js';

        window.PluginFramework = window.PluginFramework || {};
        window.PluginFramework.components = window.PluginFramework.components || {};
        window.PluginFramework.components.ActionRegistry = ActionRegistry;

        // Initialize Help Center
        window.helpCenter = new HelpCenter({
            onClose: () => console.log('Help Center closed')
        });
        document.body.appendChild(window.helpCenter.render());

        /**
         * Global helper to get project-scoped API path
         */
        window.getApiPath = function (path) {
            const projectId = localStorage.getItem('ssbackend_current_project');
            if (projectId && projectId !== 'default') {
                if (path.startsWith('/project/')) return path;
                const p = path.startsWith('/') ? path : `/${path}`;
                return `/project/${projectId}${p}`;
            }
            return path;
        };
    </script>
    <script src="script.js"></script>
    <script src="admin-dashboard-integration.js"></script>
</body>

</html>